<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Ultimate Scrolling Karaoke Viewer</title>
    
    <!-- Meta tags for better compatibility -->
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="dark">
    <div class="menu-container">
        <button class="menu-toggle" onclick="toggleMenuCollapse()" title="Toggle Menu">â–¼</button>
        <header>
            <button id="playPauseBtn" onclick="togglePlay()">â¯ï¸ Play/Pause</button>
            <button id="slowerBtn" onclick="changeSpeed(-0.5)">ğŸ¢ Slower</button>
            <button id="fasterBtn" onclick="changeSpeed(0.5)">ğŸ‡ Faster</button>
            <button id="fontPlusBtn" onclick="changeFont(2)">A+</button>
            <button id="fontMinusBtn" onclick="changeFont(-2)">A-</button>
            <button id="loadTextBtn" onclick="openPopup()">ğŸ“„ Load Text</button>

            <select id="themeSelect" onchange="setTheme(this.value)">
                <option value="dark">ğŸŒ™ Dark</option>
                <option value="light">â˜€ï¸ Light</option>
                <option value="neon">ğŸ’¡ Neon</option>
            </select>

            <button id="fullscreenBtn" onclick="toggleFullscreen()">ğŸ–¥ï¸ Fullscreen</button>
            <button id="recordBtn" class="record-btn" onclick="showRecordingOptions()">âº Record</button>
        </header>
    </div>

    <div id="viewer">
        <div id="scrollText"></div>
    </div>

    <!-- Recording Info Card -->
    <div id="recordingInfoCard">
        <div class="recording-info-header">
            <span class="pulse-dot"></span>
            <span>ğŸ”´ RECORDING IN PROGRESS</span>
            <span class="pulse-dot"></span>
        </div>
        
        <div class="recording-info-row">
            <span class="recording-info-label">â±ï¸ Elapsed Time</span>
            <span class="recording-info-value" id="elapsedTime">0:00</span>
        </div>
        
        <div class="recording-info-row">
            <span class="recording-info-label">ğŸ“Š Progress</span>
            <span class="recording-info-value" id="progressPercent">0%</span>
        </div>
        
        <div class="recording-progress-bar">
            <div class="recording-progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        
        <div class="recording-info-row">
            <span class="recording-info-label">ğŸ“ Scroll Distance</span>
            <span class="recording-info-value" id="scrollDistance">0 px</span>
        </div>
        
        <div class="recording-info-row">
            <span class="recording-info-label">âš¡ Current Speed</span>
            <span class="recording-info-value" id="currentSpeed">1.0x</span>
        </div>
        
        <div class="recording-info-row">
            <span class="recording-info-label">ğŸ¯ Frames Captured</span>
            <span class="recording-info-value" id="framesCaptured">0</span>
        </div>
        
        <button class="recording-stop-btn" onclick="stopRecording()">â¹ STOP RECORDING</button>
    </div>

    <!-- Recording Options Popup -->
    <div id="recordingOptions" class="recording-options">
        <h3>ğŸ“¹ Video Recording Options</h3>
        
        <label>ğŸ“± Social Media Preset:</label>
        <select id="socialPreset" onchange="applySocialPreset()">
            <option value="">-- Select a preset --</option>
            <option value="instagram_story">ğŸ“¸ Instagram Story (9:16, 1080x1920)</option>
            <option value="instagram_reel">ğŸ¬ Instagram Reel (9:16, 1080x1920)</option>
            <option value="instagram_post">ğŸ–¼ï¸ Instagram Post (1:1, 1080x1080)</option>
            <option value="whatsapp_status">ğŸ’¬ WhatsApp Status (9:16, 1080x1920)</option>
            <option value="tiktok">ğŸµ TikTok (9:16, 1080x1920)</option>
            <option value="facebook_story">ğŸ“˜ Facebook Story (9:16, 1080x1920)</option>
            <option value="youtube_shorts">â–¶ï¸ YouTube Shorts (9:16, 1080x1920)</option>
            <option value="snapchat">ğŸ‘» Snapchat (9:16, 1080x1920)</option>
            <option value="linkedin">ğŸ’¼ LinkedIn Post (16:9, 1920x1080)</option>
            <option value="twitter">ğŸ¦ Twitter (16:9, 1280x720)</option>
            <option value="custom">âš™ï¸ Custom Settings</option>
        </select>
        
        <div id="customSettings" style="display: none;">
            <label>Resolution:</label>
            <select id="recordResolution">
                <option value="1920x1080">1080p (1920x1080) - 16:9</option>
                <option value="1280x720">720p (1280x720) - 16:9</option>
                <option value="1920x1920">Square (1920x1920) - 1:1</option>
                <option value="1080x1920" selected>Portrait (1080x1920) - 9:16</option>
                <option value="854x480">480p (854x480) - 16:9</option>
                <option value="640x360">360p (640x360) - 16:9</option>
                <option value="640x640">Square Small (640x640) - 1:1</option>
            </select>
        </div>
        
        <label>Frame Rate:</label>
        <select id="recordFramerate">
            <option value="60">60 fps - Smooth (Best for stories)</option>
            <option value="30" selected>30 fps - Standard</option>
            <option value="24">24 fps - Cinematic</option>
            <option value="15">15 fps - Small file</option>
        </select>
        
        <label>Video Quality:</label>
        <select id="recordQuality">
            <option value="12000000">12 Mbps - Professional</option>
            <option value="8000000">8 Mbps - Best quality</option>
            <option value="5000000" selected>5 Mbps - High quality</option>
            <option value="2500000">2.5 Mbps - Medium quality</option>
            <option value="1000000">1 Mbps - Small file</option>
        </select>
        
        <label>âš¡ Speed Multiplier (for recording):</label>
        <select id="recordSpeed">
            <option value="1" selected>1x - Normal speed</option>
            <option value="0.5">0.5x - Half speed (slower scroll)</option>
            <option value="0.75">0.75x - 75% speed</option>
            <option value="1.25">1.25x - 25% faster</option>
            <option value="1.5">1.5x - 50% faster</option>
            <option value="2">2x - Double speed</option>
        </select>
        
        <!-- MP4 Format Option - Direct Recording -->
        <div style="margin: 20px 0; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; border: 1px solid #4CAF50;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="radio" name="videoFormat" id="formatWebM" value="webm" checked style="width: 20px; height: 20px; margin: 0;">
                <span style="font-size: 16px; font-weight: bold;">ğŸ“¹ WebM Format (Default)</span>
            </label>
            <p style="margin: 5px 0 10px 30px; font-size: 12px; color: #888;">
                Best compatibility, smaller file size
            </p>
            
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="radio" name="videoFormat" id="formatMP4" value="mp4" style="width: 20px; height: 20px; margin: 0;">
                <span style="font-size: 16px; font-weight: bold; color: #4CAF50;">ğŸ¬ MP4 Format (Direct Recording)</span>
            </label>
            <p style="margin: 5px 0 0 30px; font-size: 12px; color: #888;">
                Universal compatibility with all devices. Records directly in MP4 if supported.
            </p>
        </div>
        
        <div style="margin-top: 15px; padding: 10px; background: rgba(255,68,68,0.1); border-radius: 8px;">
            <p style="margin: 5px 0; font-size: 12px; color: #888;">
                <span style="color: #ff4444;">ğŸ“</span> Total scroll distance: <span id="totalScrollDist">0</span>px<br>
                <span style="color: #ff4444;">â±ï¸</span> Est. duration: <span id="estDuration">0</span> seconds
            </p>
        </div>
        
        <br>
        <button onclick="startRecording()" style="background: #ff4444;">â–¶ï¸ Start Recording</button>
        <button onclick="hideRecordingOptions()">âœ–ï¸ Cancel</button>
    </div>

    <!-- Loading Overlay for Recording -->
    <div id="recordingOverlay">
        <div class="spinner"></div>
        <div>Processing video...</div>
    </div>

    <!-- Popup for Text Input -->
    <div id="popup">
        <h3>ğŸ“ Enter Text (Plain / Markdown / HTML)</h3>
        <textarea id="newText" placeholder="Enter your text here..."></textarea>
        <div id="previewBox"></div>
        <br>
        <button onclick="saveText()">ğŸ’¾ Save</button>
        <button onclick="closePopup()">âœ–ï¸ Cancel</button>
    </div>

    <!-- html2canvas for DOM capture -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Main JavaScript -->
    <script src="js/app.js"></script>
</body>
</html>